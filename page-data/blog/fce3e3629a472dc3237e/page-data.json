{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/blog/fce3e3629a472dc3237e/","result":{"data":{"markdownRemark":{"html":"<p>よくハマりそうなのでメモ。</p>\n<h3>\n<span id=\"準備\" class=\"fragment\"></span><a href=\"#%E6%BA%96%E5%82%99\"><i class=\"fa fa-link\"></i></a>準備</h3>\n<p>ELB内のnginxでリクエスト元のIPを$remote_addrにする</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>http {\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">set_real_ip_from   10.0.0.0/8;\nreal_ip_header     X-Forwarded-For;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p>}</p>\n</pre></div></div>\n<h3>\n<span id=\"本番\" class=\"fragment\"></span><a href=\"#%E6%9C%AC%E7%95%AA\"><i class=\"fa fa-link\"></i></a>本番</h3>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>http {\n    limit_req_zone $remote_addr zone=ddos:1m  rate=10r/s;\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">server {\n\n    location / {\n        limit_req zone=ddos burst=50 nodelay;\n\n    }\n}</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>}</p>\n</pre></div></div>\n<h3>\n<span id=\"間違い\" class=\"fragment\"></span><a href=\"#%E9%96%93%E9%81%95%E3%81%84\"><i class=\"fa fa-link\"></i></a>間違い</h3>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>http {\n   limit_req_zone $http_x_fowarded_for zone=ddos:1m  rate=10r/s;\n}\n</pre></div></div>\n<p><a href=\"http://serverfault.com/questions/487463/nginx-rate-limiting-with-x-forwarded-for-header\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://serverfault.com/questions/487463/nginx-rate-limiting-with-x-forwarded-for-header</a></p>\n<p>$http_x_fowarded_forはlimit_reqに使ってはいけないとあった...</p>","frontmatter":{"date":"2014-09-30","slug":"/blog/fce3e3629a472dc3237e","title":"ELB内のngixでDDoS対策","image":null,"tags":["nginx","AWS","elb"]}}},"pageContext":{"slug":"/blog/fce3e3629a472dc3237e"}},"staticQueryHashes":["1342192543"]}