{"componentChunkName":"component---src-templates-blog-template-tsx","path":"/blog/3904a00ee798f9e37ea1/","result":{"data":{"markdownRemark":{"html":"<h3>\n<span id=\"背景\" class=\"fragment\"></span><a href=\"#%E8%83%8C%E6%99%AF\"><i class=\"fa fa-link\"></i></a>背景</h3>\n<hr>\n<p>動かしてみたいソースコードのバージョンが結構古くて、<br>\nrubyやrailsやgemはいいけどDBまわりが心配になったので仮想環境で動かすことにした。<br><br>\nちなみにホスト環境は Ubuntu 12.04 っす。</p>\n<h3>\n<span id=\"手順めも\" class=\"fragment\"></span><a href=\"#%E6%89%8B%E9%A0%86%E3%82%81%E3%82%82\"><i class=\"fa fa-link\"></i></a>手順めも</h3>\n<hr>\n<p>VirtualBoxとVagrantは既にインストール済みだったので、まずはボックスの作成。<br><br>\n自分のマシンがUbuntuなので、たまにはRedHat系をチョイス。chefもpuppetもついてる。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>vagrant init  cent64 http://developer.nrel.gov/downloads/vagrant-boxes/CentOS-6.4-x86_64-v20130427.box\n</pre></div></div>\n<p>vagrant sshで仮想環境にアクセスできることを確認。</p>\n<p>chefのインストール</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>sudo gem install chef\n</pre></div></div>\n<p>これだけだとknife solo initが動かない。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>gem install knife-solo\n</pre></div></div>\n<p>これで動くようになった。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>knife solo init chef-repo\n</pre></div></div>\n<p>これでsoloのリポジトリをつくる。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>$ knife cookbook create cent64 -o site-cookbooks\n</pre></div></div>\n<p>site-cookbooksに手書きのrecipeを置くのが通例らしい。<br><br>\nVergrantのBoxにchefは入ってるけど、念のため、ここでゲスト環境にchefを導入する。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>$ knife solo prepare cent64\n</pre></div></div>\n<p>できない。。。。networkエラー。<br><br>\nググったらsshの設定らしく次の一行を流す。</p>\n<p><br></p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>$ vagrant ssh-config --host cent64 &gt;&gt; ~/.ssh/config\n</pre></div></div>\n<p>再度挑戦。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>$ knife solo prepare cent64\nBootstrapping Chef...\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n101  6790  101  6790    0     0   6559      0  0:00:01  0:00:01 --:--:-- 19795\nDownloading Chef 11.6.0 for el...\nInstalling Chef 11.6.0\nwarning: /tmp/tmp.kuE8jQUr/chef-11.6.0.x86_64.rpm: Header V4 DSA/SHA1 Signature, key ID 83ef826a: NOKEY\nPreparing...                ########################################### [100%]\n   1:chef                   ########################################### [100%]\nThank you for installing Chef!\nGenerating node config 'nodes/cent64.json'...\n</pre></div></div>\n<p>よっしゃ。続いてレシピを書く。<br><br>\nsite-cookbooks/cent64/recipes/default.rb　に次を追記。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>package \"httpd\" do\n  action :install\nend\n<p>service \"httpd\" do\naction :start\nend</p>\n</pre></div></div>\n<p>これでwebサーバがインストールされて立ち上がるはず。<br><br>\nnodes/cent64.json　にレシピを読み込むように次を追記。  </p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>  {\"run_list\":[\"cent64\"]}\n</pre></div></div>\n<p>レシピをコンパイルして適用する。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>~/chef-repo$ knife solo cook cent64\nRunning Chef on cent64...\nChecking Chef version...\nUploading the kitchen...\nGenerating solo config...\nRunning Chef...\nStarting Chef Client, version 11.6.0\nCompiling Cookbooks...\nConverging 2 resources\nRecipe: cent64::default\n  * package[httpd] action install\n    - install version 2.2.15-29.el6.centos of package httpd\n<ul>\n<li>\n<p>service[httpd] action start</p>\n<ul>\n<li>start service service[httpd]</li>\n</ul>\n</li>\n</ul>\n<p>Chef Client finished, 2 resources updated</p>\n</pre></div></div>\n<p>おおおおお。できてんじゃん。<br><br>\nゲストのほうでサービスを確認する。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>$ sudo service httpd status\nhttpd (pid  2683) is running...\n</pre></div></div>\n<p>よし。ここまでで一段落。<br><br>\nせっかくなのでブラウザからも見れるように設定する。  </p>\n<p>Vagrantfileを編集。次の行のコメントを外す。  </p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>   config.vm.network :private_network, ip: \"192.168.33.10\"\n</pre></div></div>\n<p>このままだとiptablesが邪魔して80番でアクセスできないから、recipeに次を追記。</p>\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>service \"iptables\" do \n  action [:stop, :disable]\nend\n</pre></div></div>\n<p>ブラウザのアドレスバーに \"192.168.33.10\"を入力して元気良くエンターキーを押下する</p>\n<p><a href=\"http://sitedo3.s3.amazonaws.com/2013/10/apache2.png\" rel=\"nofollow noopener\" target=\"_blank\"><img src=\"http://sitedo3.s3.amazonaws.com/2013/10/apache2-300x163.png\" alt=\"apache2\" width=\"300\" height=\"163\" data-canonical-src=\"http://sitedo3.s3.amazonaws.com/2013/10/apache2-300x163.png\" loading=\"lazy\"></a></p>\n<p>できた！</p>\n<p>まだまだ続く・・・</p>\n<p>参考<br><br>\n<a href=\"http://ka-zoo.net/2013/06/chef-solo-knife-solo-%E5%B0%8E%E5%85%A5%E3%83%A1%E3%83%A2/\" title=\"http://ka-zoo.net/2013/06/chef-solo-knife-solo-%E5%B0%8E%E5%85%A5%E3%83%A1%E3%83%A2/ \" rel=\"nofollow noopener\" target=\"_blank\"></a><a href=\"http://ka-zoo.net/2013/06/chef-solo-knife-solo-%E5%B0%8E%E5%85%A5%E3%83%A1%E3%83%A2/\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://ka-zoo.net/2013/06/chef-solo-knife-solo-%E5%B0%8E%E5%85%A5%E3%83%A1%E3%83%A2/</a>  <br>\n<a href=\"http://dotinstall.com/lessons/basic_vagrant\" title=\"http://dotinstall.com/lessons/basic_vagrant  \" rel=\"nofollow noopener\" target=\"_blank\"></a><a href=\"http://dotinstall.com/lessons/basic_vagrant\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://dotinstall.com/lessons/basic_vagrant</a>  <br>\n<a href=\"http://dotinstall.com/lessons/basic_chef\" title=\"http://dotinstall.com/lessons/basic_chef  \" rel=\"nofollow noopener\" target=\"_blank\"></a><a href=\"http://dotinstall.com/lessons/basic_chef\" class=\"autolink\" rel=\"nofollow noopener\" target=\"_blank\">http://dotinstall.com/lessons/basic_chef</a>   </p>","frontmatter":{"date":"2014-05-07","slug":"/blog/3904a00ee798f9e37ea1","title":"vagrant + chef-solo でRailsを動かす - 1 -","image":null,"tags":["Rails","Vagrant","chef-solo"]}}},"pageContext":{"slug":"/blog/3904a00ee798f9e37ea1"}},"staticQueryHashes":["1342192543"]}